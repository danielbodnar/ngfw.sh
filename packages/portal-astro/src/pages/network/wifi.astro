---
import PortalLayout from '../../layouts/PortalLayout.astro';
import WiFiNetworkCard from '../../components/network/WiFiNetworkCard.vue';
import RadioSettings from '../../components/network/RadioSettings.vue';

// Redirect to sign-in if not authenticated
const { userId } = Astro.locals.auth();\nif (!userId) {
  return Astro.redirect('/sign-in');
}
---

<PortalLayout title="WiFi - NGFW.sh">
  <div class="space-y-6">
    <div>
      <h2 class="text-2xl font-semibold text-[--color-text-primary] mb-1">
        WiFi Networks
      </h2>
      <p class="text-[--color-text-secondary]">
        Configure wireless networks and radio settings
      </p>
    </div>

    <div id="wifi-app"></div>
  </div>
</PortalLayout>

<script>
  import { createApp } from 'vue';
  import WiFiNetworkCard from '../../components/network/WiFiNetworkCard.vue';
  import RadioSettings from '../../components/network/RadioSettings.vue';

  // Mock data - will be replaced by composables
  const mockNetworks = [
    {
      id: '1',
      ssid: 'Home WiFi',
      band: '5GHz',
      channel: 36,
      encryption: 'WPA3',
      password: 'supersecret123',
      hidden: false,
      enabled: true,
      clients_connected: 12,
      vlan_id: null,
    },
    {
      id: '2',
      ssid: 'Guest Network',
      band: '2.4GHz',
      channel: 6,
      encryption: 'WPA2',
      password: 'guestpass',
      hidden: false,
      enabled: true,
      clients_connected: 3,
      vlan_id: 10,
    },
    {
      id: '3',
      ssid: 'IoT Devices',
      band: '2.4GHz',
      channel: 11,
      encryption: 'WPA2',
      password: 'iot_secure',
      hidden: true,
      enabled: true,
      clients_connected: 8,
      vlan_id: 20,
    },
  ];

  const mockRadioSettings = {
    '2.4GHz': {
      enabled: true,
      channel: 6,
      channel_width: '20MHz',
      tx_power: 20,
      mode: '802.11n',
    },
    '5GHz': {
      enabled: true,
      channel: 36,
      channel_width: '80MHz',
      tx_power: 23,
      mode: '802.11ax',
    },
  };

  const App = {
    components: { WiFiNetworkCard, RadioSettings },
    data() {
      return {
        networks: mockNetworks,
        radioSettings: mockRadioSettings,
      };
    },
    methods: {
      handleAddNetwork() {
        console.log('Add network clicked');
        // TODO: Show network form
      },
      handleEditNetwork(network) {
        console.log('Edit network:', network);
        // TODO: Show network form with data
      },
      handleDeleteNetwork(networkId) {
        if (confirm('Are you sure you want to delete this network?')) {
          this.networks = this.networks.filter(n => n.id !== networkId);
        }
      },
      handleToggleNetwork(networkId) {
        const network = this.networks.find(n => n.id === networkId);
        if (network) {
          network.enabled = !network.enabled;
        }
      },
      handleSaveRadio(band, settings) {
        this.radioSettings[band] = settings;
        console.log('Saving radio settings:', band, settings);
        // TODO: Call API composable
      },
    },
    template: `
      <div class="space-y-6">
        <div>
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-medium text-[--color-text-primary]">Wireless Networks</h3>
            <button
              @click="handleAddNetwork"
              class="px-4 py-2 bg-[--color-primary] text-white rounded-lg hover:bg-[--color-primary-hover] transition-colors"
            >
              Add Network
            </button>
          </div>
          <div class="grid gap-4">
            <WiFiNetworkCard
              v-for="network in networks"
              :key="network.id"
              :network="network"
              @edit="handleEditNetwork"
              @delete="handleDeleteNetwork"
              @toggle="handleToggleNetwork"
            />
          </div>
        </div>

        <RadioSettings
          band="2.4GHz"
          :settings="radioSettings['2.4GHz']"
          @save="(settings) => handleSaveRadio('2.4GHz', settings)"
        />

        <RadioSettings
          band="5GHz"
          :settings="radioSettings['5GHz']"
          @save="(settings) => handleSaveRadio('5GHz', settings)"
        />
      </div>
    `,
  };

  const app = createApp(App);
  app.mount('#wifi-app');
</script>
