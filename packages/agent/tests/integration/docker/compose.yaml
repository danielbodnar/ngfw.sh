services:
  mock-api:
    image: oven/bun:1
    working_dir: /app
    volumes:
      - ../mock-api:/app:ro
    command: ["bun", "run", "server.ts"]
    ports:
      - "8787:8787"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8787/health"]
      interval: 2s
      timeout: 5s
      retries: 10

  agent:
    build:
      context: ../../..
      dockerfile: tests/integration/docker/Dockerfile
    depends_on:
      mock-api:
        condition: service_healthy
    tmpfs:
      - /sys:exec
    volumes:
      - /proc:/proc:ro
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "2"
