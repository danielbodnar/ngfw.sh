## Test Failures — Partially Addressed

**Priority:** MEDIUM
**Found by:** Rust Test Runner Agent

### Issue

The main `test_dispatcher_mode_update` test exists and appears functional in [`packages/agent/tests/integration_dispatcher.rs`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/agent/tests/integration_dispatcher.rs#L441), but the related `test_e2e_mode_transition` test referenced in the original report does not exist.

### Current Status

- `test_dispatcher_mode_update` — **Present** (lines 441-481), sends ModeUpdate and validates ModeAck
- `test_e2e_mode_transition` — **Missing** (never implemented or was removed)
- Related tests exist: `test_dispatcher_reboot_denied_in_observe()`, `test_dispatcher_upgrade_denied_in_shadow()`

### Remaining Work

1. Verify `test_dispatcher_mode_update` passes reliably
2. Decide whether `test_e2e_mode_transition` is still needed
3. If needed, implement end-to-end mode transition test covering Shadow → Takeover flow

### Files

- [`packages/agent/tests/integration_dispatcher.rs`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/agent/tests/integration_dispatcher.rs)
- [`packages/agent/src/dispatcher.rs`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/agent/src/dispatcher.rs)

### Effort

1 hour
