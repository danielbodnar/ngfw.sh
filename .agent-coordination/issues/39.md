## Performance Optimization — Partially Addressed

**Priority:** HIGH
**Found by:** Performance Engineer Agent

### Issue

Missing indexes on critical database columns. Some indexes have been added but coverage is incomplete.

### Current Index Status

**Already created (5 indexes):**
- `idx_subscriptions_user_id` on subscriptions(user_id) — [migration 0002](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/schema/migrations)
- `idx_subscriptions_status` on subscriptions(status) — migration 0002
- `idx_ddns_configs_device_id` on ddns_configs(device_id) — migration 0006
- `idx_devices_owner` on devices(owner_id) — migration 0005
- `idx_devices_api_key` (UNIQUE) on devices(api_key) — migration 0005

**Still missing:**
- `idx_logs_device_id_timestamp` on logs(device_id, timestamp DESC)
- `idx_logs_level` on logs(level)
- `idx_metrics_device_id_timestamp` on metrics(device_id, timestamp DESC)

### Impact

- Log queries: still ~300ms without composite index
- Metric queries: still ~200ms without composite index

### Solution

Create a new D1 migration adding the missing indexes:

```sql
CREATE INDEX idx_logs_device_id_timestamp ON logs(device_id, timestamp DESC);
CREATE INDEX idx_logs_level ON logs(level);
CREATE INDEX idx_metrics_device_id_timestamp ON metrics(device_id, timestamp DESC);
```

### Files

- Migrations: [`packages/schema/migrations/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/schema/migrations)

### Effort

1-2 hours (reduced from original estimate — partial work done)
