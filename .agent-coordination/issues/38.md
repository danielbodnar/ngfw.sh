## Performance Optimization

**Priority:** HIGH
**Found by:** Performance Engineer Agent

### Issue

JWT validation on every request without caching. The auth middleware at [`packages/schema/src/middleware/auth.ts`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/schema/src/middleware/auth.ts) performs direct `verifyToken()` calls with no cache layer.

- **Current:** ~150ms per request (full JWT verification + JWKS fetch)
- **Target:** ~10ms per request
- **Improvement: 93% reduction**

### Impact

- Poor auth performance
- Unnecessary external API calls to Clerk on every request
- Increased latency across all authenticated endpoints

### Solution

Implement JWT token caching in KV with 5-minute TTL:

```typescript
const cacheKey = `jwt:${token.substring(0, 16)}`;
const cached = await env.KV.get(cacheKey);
if (cached) return JSON.parse(cached);

const validated = await clerk.validateJWT(token);
await env.KV.put(cacheKey, JSON.stringify(validated), { expirationTtl: 300 });
```

### Expected Impact

- Auth latency: 150ms → 10ms (93% reduction)
- Overall API P95: 800ms → 250ms

### Files

- [`packages/schema/src/middleware/auth.ts`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/schema/src/middleware/auth.ts)

### Effort

4-6 hours
