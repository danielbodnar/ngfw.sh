## Architectural Issue

**Priority:** HIGH
**Found by:** Architecture Review Agent

### Issue

Two separate API servers with overlapping responsibilities:

- **Rust API** ([`packages/api/src/handlers/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/api/src/handlers)): 9 handler files covering network, system, security, services, fleet, user, agent, and router endpoints
- **TypeScript Schema API** ([`packages/schema/src/endpoints/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/schema/src/endpoints)): 101 endpoint files across 19 subdirectories (fleet, network, security, VPN, DDNS, QoS, IPS, billing, etc.)

Both access same D1 and KV storage, creating data consistency risk.

### Impact

- Unclear ownership of endpoints
- Data consistency issues
- Maintenance burden (changes must be duplicated)
- Developer confusion about which API to call

### Recommendation

Choose one strategy:

1. **Option A:** Schema API handles all REST, Rust API only WebSocket/Durable Objects
   - Effort: 2-3 days refactoring
2. **Option B:** Deprecate one API server entirely
   - Effort: 3-5 days if keeping Rust, 1-2 days if keeping TypeScript

### Key Files

- Rust handlers: [`packages/api/src/handlers/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/api/src/handlers)
- Rust storage: [`packages/api/src/storage/mod.rs`](https://github.com/danielbodnar/ngfw.sh/blob/main/packages/api/src/storage/mod.rs)
- TS endpoints: [`packages/schema/src/endpoints/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/schema/src/endpoints)
- TS middleware: [`packages/schema/src/middleware/`](https://github.com/danielbodnar/ngfw.sh/tree/main/packages/schema/src/middleware)
